generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(cuid())
  email      String      @unique
  password   String
  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt
  active     UserStatus  @default(INACTIVE)
  name       String
  Dentist    Dentist[]
  Patient    Patient[]
  Secretary  Secretary[]
  user_role  UserRole[]

  @@map("usuarios")
}

model Role {
  id          String     @id @default(cuid())
  name        String     @unique
  description String
  UserRole    UserRole[]

  @@map("permissoes")
}

model UserRole {
  userId String @default(cuid())
  roleId String @default(cuid())
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId], map: "usuarios_permissoes_roleId_fkey")
  @@map("usuarios_permissoes")
}

model Secretary {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "secretarias_userId_fkey")
  @@map("secretarias")
}

model Dentist {
  id               String             @id @default(cuid())
  userId           String
  cro              String             @unique
  user             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  DentistProcedure DentistProcedure[]
  MedicalHistory   MedicalHistory[]

  @@index([userId], map: "dentistas_userId_fkey")
  @@map("dentistas")
}

model Procedure {
  id               String             @id @default(cuid())
  name             String             @unique
  price            Float              @default(0)
  DentistProcedure DentistProcedure[]

  @@map("procedimentos")
}

model DentistProcedure {
  dentistId     String
  procedureId   String
  scheduled_at  DateTime          @default(now())
  scheduled_for DateTime
  approved      ProcedureApproval @default(NOT_APPROVED)
  patientId     String
  dentist       Dentist           @relation(fields: [dentistId], references: [id], onDelete: Cascade)
  patient       Patient           @relation(fields: [patientId], references: [id], onDelete: Cascade)
  procedure     Procedure         @relation(fields: [procedureId], references: [id], onDelete: Cascade)

  @@id([dentistId, procedureId, patientId])
  @@index([procedureId], map: "dentistas_procedimentos_procedureId_fkey")
  @@index([patientId], map: "dentistas_procedimentos_patientId_fkey")
  @@map("dentistas_procedimentos")
}

model HealthInsurance {
  id                     String                   @id @default(cuid())
  name                   String
  code                   String                   @unique
  PatientHealthInsurance PatientHealthInsurance[]

  @@map("convenios")
}

model Patient {
  id                           String                   @id @default(cuid())
  birth_date                   DateTime
  health_insurance_card_number String?
  userId                       String
  DentistProcedure             DentistProcedure[]
  MedicalHistory               MedicalHistory[]
  user                         User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  PatientHealthInsurance       PatientHealthInsurance[]

  @@index([userId], map: "pacientes_userId_fkey")
  @@map("pacientes")
}

model PatientHealthInsurance {
  patientId         String
  healthInsuranceId String
  healthInsurance   HealthInsurance @relation(fields: [healthInsuranceId], references: [id], onDelete: Cascade)
  patient           Patient         @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@id([patientId, healthInsuranceId])
  @@index([healthInsuranceId], map: "pacientes_convenios_healthInsuranceId_fkey")
  @@map("pacientes_convenios")
}

model MedicalHistory {
  id          String   @id @default(cuid())
  description String
  created_at  DateTime @default(now())
  dentistId   String
  patientId   String
  updated_at  DateTime @updatedAt
  dentist     Dentist  @relation(fields: [dentistId], references: [id], onDelete: Cascade)
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([dentistId], map: "historico_medico_dentistId_fkey")
  @@index([patientId], map: "historico_medico_patientId_fkey")
  @@map("historico_medico")
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum ProcedureApproval {
  APPROVED
  NOT_APPROVED
}
